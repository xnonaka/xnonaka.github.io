{
  "hash": "85e14f34dffce051a8e1db2d3962a5a1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Traffic Stop Analysis\"\nauthor: Xander Nonaka\ndate: December 1, 2025 \nformat: \n  html:\n    code-fold: TRUE\nexecute: \n  warning: false\n  message: false\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DBI)\nlibrary(ggplot2)\nlibrary(tidyverse)\ncon_traffic <- DBI::dbConnect(\n\n  RMariaDB::MariaDB(),\n\n  dbname = \"traffic\",\n\n  host = Sys.getenv(\"TRAFFIC_HOST\"),\n\n  user = Sys.getenv(\"TRAFFIC_USER\"),\n\n  password = Sys.getenv(\"TRAFFIC_PWD\")\n)\n```\n:::\n\n\nI investigate trends in traffic/pedestrian stop data from my hometown of San Francisco. The first analyses I did was frequency throughout the day. I sought to visualize the trends over the course of the day by grouping by time and plotting each count. The time for each stop was marked with the hour and minute (seconds not specified) for San Francisco, so I grouped by the time variable to count the frequency at each minute in the day. \n\n\n::: {.cell}\n\n```{.sql .cell-code}\nDESCRIBE ca_san_francisco_2020_04_01;\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n|Field          |Type       |Null |Key |Default |Extra |\n|:--------------|:----------|:----|:---|:-------|:-----|\n|raw_row_number |text       |YES  |    |NA      |      |\n|date           |date       |YES  |    |NA      |      |\n|time           |time       |YES  |    |NA      |      |\n|location       |text       |YES  |    |NA      |      |\n|lat            |double     |YES  |    |NA      |      |\n|lng            |double     |YES  |    |NA      |      |\n|district       |text       |YES  |    |NA      |      |\n|subject_age    |bigint(20) |YES  |    |NA      |      |\n|subject_race   |text       |YES  |    |NA      |      |\n|subject_sex    |text       |YES  |    |NA      |      |\n\n</div>\n:::\n\n\n\n::: {.cell output.var='time_table'}\n\n```{.sql .cell-code}\nSELECT time, COUNT(*) AS num_stops\nFROM ca_san_francisco_2020_04_01\nGROUP BY time  \n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime_table2 <- time_table %>% \n  filter(!is.na(time)) %>% \n  arrange(time)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntime_table2 %>% \n  ggplot(aes(x = time, y = num_stops)) +\n  geom_point() +\n  labs(x = \"Time\", \n       y = \"Number of Stops\", \n       title = \"Number of stops throughout day\")\n```\n\n::: {.cell-output-display}\n![](project5_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nBased on the plot of counts at each minute, there is an evident discrepency in the time data. Upon observing the data, it is clear that for minute multiples of 5 (and especially 10) the count spikes (i.e. 1:30 much higher than 1:29 and 1:31). This can be viewed in the plot, with consistent low values and regular spikes every 5 minutes. I made the assumption that when an individual traffic stop is recorded, the time of day is often rounded to the nearest regular 5th minute. This is especially clear when observing 10 minute marks, as every 10 minutes after the hour, the count spikes singificantly. To account for the variability of rounding, I chose to only include the count for every 10th minute in my plot. \n\n::: {.cell}\n\n```{.r .cell-code}\ntime_table5 <- time_table2 %>% \n  filter(minute(time) %in% c(0, 10, 20, 30, 40, 50))\ntime_table5 %>% \n  ggplot(aes(x = time, y = num_stops)) + \n  geom_point() +\n  geom_smooth() +\n  labs(x = \"Time\", \n       y = \"Number of Stops\", \n       title = \"Number of Stops (Every 10th minute)\")\n```\n\n::: {.cell-output-display}\n![](project5_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nThere is still some short-term variation and spikes, but it is easier to observe a trend using the geom_smooth line. There is a clear drop in the early morning after 12AM, before the count begins to rise again around 5AM. This is likely when the number of cars on the road starts to increase. The count increases throughout the day, with the slope decreasing gradually after 10AM (before seemingly increasing slightly in the evening). \n\n::: {.cell output.var='weekend_table'}\n\n```{.sql .cell-code}\nSELECT time, COUNT(*) AS num_stops, DAYNAME(date) AS wday \nFROM ca_san_francisco_2020_04_01\nGROUP BY time, DAYNAME(date)\nHAVING wday IN (\"Friday\", \"Saturday\", \"Sunday\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweekend_table1 <- weekend_table %>% \n  filter(!is.na(time)) %>% \n  filter(!is.na(wday)) %>% \n  filter(minute(time) %in% c(0, 30))\nweekend_table1 %>% \n  ggplot(aes(x = time, y = num_stops, color = wday)) + \n  geom_point() +\n  geom_smooth() +\n  labs(x = \"Time\", \n       y = \"Number of Stops\", \n       title = \"Number of Stops (Every 30th minute)\")\n```\n\n::: {.cell-output-display}\n![](project5_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nIn this graph I isolate the data from Fridays, Saturdays and Sundays. To simplify the plot and reduce additional data collection variability, I filter for the stops only from either on the hour or half past. It seems that Friday has a higher number of stops from around 4AM to after 8PM. Sunday has significantly fewer stops in the evening, with the difference only growing later into the night. Interestingly, the positions at the end of the plot are vastly different than the beginning of the plot, though I'm not sure of a possible explaination. \n\nI was also curious to analyze traffic stop data based on race for young adults. To make additional comparison, I added the data set from Oakland. I  filtered the data to include just the stops where the subject was under 25 years old. \n\n\n::: {.cell output.var='table3'}\n\n```{.sql .cell-code}\nSELECT subject_race, COUNT(*) AS num_stops, \"San Francisco\" AS city \nFROM ca_san_francisco_2020_04_01\nWHERE subject_age < 25\nGROUP BY subject_race\n\nUNION \n\nSELECT subject_race, COUNT(*) AS num_stops, \"Oakland\" AS city \nFROM ca_oakland_2020_04_01\nWHERE subject_age < 25\nGROUP BY subject_race\n\nORDER BY num_stops DESC \n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable3 %>% \n  group_by(subject_race) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 3\n# Groups:   subject_race [5]\n   subject_race           num_stops city         \n   <chr>                    <int64> <chr>        \n 1 white                      47476 San Francisco\n 2 black                      33496 San Francisco\n 3 asian/pacific islander     25468 San Francisco\n 4 hispanic                   24410 San Francisco\n 5 other                      16435 San Francisco\n 6 black                       5967 Oakland      \n 7 hispanic                    2945 Oakland      \n 8 asian/pacific islander       371 Oakland      \n 9 white                        368 Oakland      \n10 other                        324 Oakland      \n```\n\n\n:::\n\n```{.r .cell-code}\ntable3 %>% \n  group_by(city) %>% \n  summarize(sum(num_stops))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  city          `sum(num_stops)`\n  <chr>                  <int64>\n1 Oakland                   9975\n2 San Francisco           147285\n```\n\n\n:::\n:::\n\nIn the 25 and under data for both cities, Black young adults are disproportionately the subjects of traffic/pedestrian stops. They made up 22% of stops in San Francisco despite making up only 5-6% of the city's population, and over half of stops in Oakland despite making up only 20% of the population. In Oakland, the white population makes up about a quarter of the city, but only 4% of young adults stopped in Oakland were white. \n\nReferences \n\nE. Pierson, C. Simoiu, J. Overgoor, S. Corbett-Davies, D. Jenson, A. Shoemaker, V. Ramachandran, P. Barghouty, C. Phillips, R. Shroff, and S. Goel. “A large-scale analysis of racial disparities in police stops across the United States”. Nature Human Behaviour, Vol. 4, 2020.\n\n\n\n\n\n",
    "supporting": [
      "project5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}